FROM node:20.11.0-alpine AS build

WORKDIR /app   
COPY . /app
ARG BASE_DOMAIN_WITH_PROTOCOL
ENV BASE_DOMAIN_WITH_PROTOCOL=${BASE_DOMAIN_WITH_PROTOCOL}
ARG BASE_MARKET_WEB_PATH
ENV BASE_WEB_PATH=${BASE_MARKET_WEB_PATH}
ARG BASE_MARKET_SERVER_PATH
ENV BASE_SERVER_PATH=${BASE_MARKET_SERVER_PATH}
ARG MARKET_SUPABASE_URL
ENV SUPABASE_URL=${MARKET_SUPABASE_URL}
ARG MARKET_SUPABASE_ANON_KEY
ENV SUPABASE_ANON_KEY=${MARKET_SUPABASE_ANON_KEY}

RUN npm install --legacy-peer-deps
RUN npm run build

FROM nginx:stable-alpine AS serve

COPY --from=build /app/build /usr/share/nginx/html
