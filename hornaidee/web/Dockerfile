FROM node:20.11.0-alpine AS build

WORKDIR /app
COPY . /app

ARG BASE_DOMAIN_WITH_PROTOCOL
ENV NEXT_PUBLIC_BASE_DOMAIN_WITH_PROTOCOL=${BASE_DOMAIN_WITH_PROTOCOL}
ARG MAIN_URL
ENV NEXT_PUBLIC_MAIN_URL=${MAIN_URL}
ARG BASE_DORM_WEB_PATH
ENV NEXT_PUBLIC_BASE_WEB_PATH=${BASE_DORM_WEB_PATH}
ARG BASE_DORM_SERVER_PATH
ENV NEXT_PUBLIC_BASE_SERVER_PATH=${BASE_DORM_SERVER_PATH}
ARG BASE_SUPERAPP_WEB_PATH
ENV NEXT_PUBLIC_BASE_SUPERAPP_WEB_PATH=${BASE_SUPERAPP_WEB_PATH}
ARG BASE_SUPERAPP_SERVER_PATH
ENV NEXT_PUBLIC_BASE_SUPERAPP_SERVER_PATH=${BASE_SUPERAPP_SERVER_PATH}
ARG DORM_SUPABASE_URL
ENV NEXT_PUBLIC_SUPABASE_URL=${DORM_SUPABASE_URL}
ARG DORM_SUPABASE_ANON_KEY
ENV NEXT_PUBLIC_SUPABASE_ANON_KEY=${DORM_SUPABASE_ANON_KEY}
ARG AZURE_MAPS_KEY
ENV NEXT_PUBLIC_AZURE_MAPS_KEY=${AZURE_MAPS_KEY}
ARG SENTRY_AUTH_TOKEN
# ENV SENTRY_AUTH_TOKEN=${SENTRY_AUTH_TOKEN}
RUN npm install --omit=dev
RUN npm run build
EXPOSE 3003

ENTRYPOINT [ "npm", "start" ]